<?php declare(strict_types=1);

/** @var \Magento\Framework\View\Element\Template $block */
/** @var \Magento\Framework\Escaper $escaper */

?>

<script type="text/x-magento-init">{
    "*": {
        "Magento_Ui/js/core/app": {
            "components": {
                "exampleUiComponent": {
                    "component": "Evozon_M2Demo/js/ui-component",
                    "label": "My first default JSON label property UiComponent! (2)",
                    "config": {
                        "label": "My first default JSON label config property UiComponent! (3)"
                    }
                },
                "testUiChild": {
                    "component": "uiComponent",
                    "template": "Evozon_M2Demo/ui-component-render",
                    "children": {
                        "child1": {
                            "component": "uiComponent",
                            "template": "Evozon_M2Demo/info",
                            "children": {
                                "child2": {
                                    "component": "uiComponent",
                                    "template": "Evozon_M2Demo/info"
                                }
                            }
                        },
                        "child3": {
                            "component": "uiComponent",
                            "template": "Evozon_M2Demo/info",
                            "displayArea": "groupA"
                        },
                        "child4": {
                            "component": "uiComponent",
                            "template": "Evozon_M2Demo/info",
                            "displayArea": "groupA"
                        }
                    }
                },
                "uiComponentToImport": {
                    "component": "Evozon_M2Demo/js/ui-component-to-import"
                }
            }
        }
    }
}
</script>
<div data-bind="scope: 'exampleUiComponent'">
    <!-- ko template: getTemplate() --><!-- /ko -->
</div>

<?php
// using uiComponent instead of our own here, and a custom template to show the UiComponents hierarchy
// we can use require('uiRegistry').get('index = child1').name to get a specific child by index
// or we can pass a callback function as a 2rd parameter that applies to that specific element by using
// require('uiRegistry').get('index = child1', function (c) {console.log(c.name)})

// <!-- ko template: getTemplate() --><!-- /ko --> can be abbreviated to <render />
?>

<div data-bind="scope: 'testUiChild'">
    <div data-bind="template: getTemplate()"></div>

    <?php // display the children by group ?>
    <!-- ko foreach: getRegion('groupA') -->
    <!-- ko template: getTemplate() --><!-- /ko -->
    <!-- /ko -->
</div>

<script type="text/x-magento-init">
{
    "*": {
        "Magento_Ui/js/core/app": <?= $block->getJsLayout(); ?>
    }
}
</script>
<?php // provider and providerProperty are used to prevent duplicate of names when importing ?>

<div data-bind="scope: 'component-a'">
    <h3 data-bind="text: label"></h3>
    <div data-bind="text: amount"></div>
</div>
<div data-bind="scope: 'component-b'">
    <h3 data-bind="text: title"></h3>
    <div data-bind="text: value"></div>
</div>

<?php
// get, set and remove methods are inherited for UiComponent from element.js (which in turn uses mageUtils)
// we can use require('uiRegistry').get(vm => console.log(vm.name)) to get all the UiComponent names
// and require('uiRegistry').get('minicart_content').get('some.property') to retrieve some.property,
// which is the same as require('uiRegistry').get('minicart_content').some.property but safe to use, as it includes
// safety checks,
// require('uiRegistry').get('minicart_content').set('some.property', 42) to set the value,
// require('uiRegistry').get('minicart_content').remove('some.property') to remove the property (not the some though),
// for that we need require('uiRegistry').get('minicart_content').remove('some')
?>

<hr/>

<?php
// UiComponent load order can be altered with the deps property, where we can specify which other component(s) should
// be loaded before this one, by their name (root.sharedState here),
// or by using any valid Ui registry selector can be used (as in this example, index = sharedState), found in the
// frontend/layout/evozon_evozon_uicomponent.xml file

// fun fact: if the component does not have a provider set, the first deps is used there instead
?>
<div data-bind="scope: 'root'">
    <div>
        The UiComponent instance load order test value is:
        <span data-bind="text: value"></span>
    </div>
</div>
